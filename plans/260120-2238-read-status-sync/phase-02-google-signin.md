# Phase 02: Implement Google Sign-In Authentication
Status: ⬜ Pending  
Dependencies: Phase 01

## Objective
Implement Google Sign-In flow with Firebase Authentication, including sign-in button, authentication logic, and user state management.

## Requirements
### Functional
- [ ] Add Google Sign-In button to Settings screen
- [ ] Implement sign-in flow using Firebase Auth
- [ ] Store user authentication state
- [ ] Handle sign-out
- [ ] Display user info (name, email, photo) in Settings
- [ ] Auto sign-in on app launch (if previously signed in)

### Non-Functional
- [ ] Security: Use Firebase Auth tokens, never store passwords
- [ ] UX: Sign-in should complete within 3 seconds on good connection

## Implementation Steps
1. [ ] Create `AuthManager.kt` - Singleton to handle authentication
   - `signInWithGoogle(activity: Activity): Flow<AuthResult>`
   - `signOut()`
   - `getCurrentUser(): FirebaseUser?`
   - `isSignedIn(): Boolean`
   - `userStateFlow: StateFlow<FirebaseUser?>`

2. [ ] Create `AuthViewModel.kt` - ViewModel for Settings screen
   - Observe `AuthManager.userStateFlow`
   - Expose UI state: `AuthUiState(user, isLoading, error)`

3. [ ] Modify `SettingsScreen.kt`:
   - Add Google Sign-In button (when not signed in)
   - Display user info card (when signed in)
   - Add "Đăng xuất" button

4. [ ] Implement sign-in flow:
   ```kotlin
   val googleSignInClient = GoogleSignIn.getClient(activity, gso)
   val signInIntent = googleSignInClient.signInIntent
   launcher.launch(signInIntent) // ActivityResultContract
   
   // Handle result:
   val account = GoogleSignIn.getSignedInAccountFromIntent(data)
   val credential = GoogleAuthProvider.getCredential(account.idToken, null)
   FirebaseAuth.getInstance().signInWithCredential(credential)
   ```

5. [ ] Handle errors:
   - Network error → Show Toast "Không có mạng"
   - Canceled by user → Do nothing
   - Unknown error → Show "Đăng nhập thất bại"

6. [ ] Add auto sign-in check in MainActivity:
   - Check `FirebaseAuth.currentUser` on launch
   - If null → Show sign-in prompt (optional for this phase)

## Files to Create/Modify
- `app/src/main/java/[package]/auth/AuthManager.kt` - NEW
- `app/src/main/java/[package]/auth/AuthViewModel.kt` - NEW
- `app/src/main/java/[package]/ui/screens/SettingsScreen.kt` - MODIFY
- `app/src/main/res/drawable/ic_google.xml` - NEW (Google logo icon)

## Test Criteria
- [ ] Clicking "Đăng nhập Google" opens Google account picker
- [ ] After selecting account, user info appears in Settings
- [ ] Sign-out button works, returns to sign-in state
- [ ] Restarting app maintains signed-in state
- [ ] Airplane mode → Sign-in fails with proper error message

## Notes
- **Google Sign-In Options (GSO):**
  ```kotlin
  val gso = GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
      .requestIdToken(getString(R.string.default_web_client_id)) // Auto-generated by Firebase
      .requestEmail()
      .build()
  ```

- **UI Design:** Simple material button with Google logo
  ```kotlin
  Button(onClick = { viewModel.signIn() }) {
      Icon(painter = painterResource(R.drawable.ic_google), ...)
      Text("Đăng nhập bằng Google")
  }
  ```

---
Next Phase: [phase-03-local-database.md](file:///C:/Users/Admin/Desktop/Test_code/RSS-Reader-main/plans/260120-2238-read-status-sync/phase-03-local-database.md)
