# Audit Report - 2026-01-19

## Summary
- ğŸ”´ **Critical Issues:** 0 (Codebase is relatively secure)
- ğŸŸ¡ **Warnings:** 3 (High complexity in key services)
- ğŸŸ¢ **Suggestions:** 3 (Refactoring & Best Practices)

---

## ğŸ”´ Critical Issues (Pháº£i sá»­a ngay)
*KhÃ´ng tÃ¬m tháº¥y váº¥n Ä‘á» báº£o máº­t nghiÃªm trá»ng nÃ o (Hardcoded secrets, API Keys exposure, SQL Injection).*

---

## ğŸŸ¡ Warnings (NÃªn sá»­a)

### 1. "God Class" Complexity - `ArticleContentFetcher.kt`
- **File:** `app/src/main/java/com/skul9x/rssreader/data/network/ArticleContentFetcher.kt`
- **Váº¥n Ä‘á»:** File nÃ y quÃ¡ lá»›n (>1200 dÃ²ng) vÃ  chá»©a logic parse cho quÃ¡ nhiá»u trang bÃ¡o khÃ¡c nhau (VnExpress, GenK, TuoiTre...).
- **Táº¡i sao nguy hiá»ƒm:** Ráº¥t khÃ³ báº£o trÃ¬. Náº¿u muá»‘n sá»­a logic parse cá»§a 1 trang, cÃ³ thá»ƒ lÃ m há»ng trang khÃ¡c. Code "spaghetti" vá»›i hÃ ng tÃ¡ Regex pattern.
- **CÃ¡ch sá»­a:** Sá»­ dá»¥ng **Strategy Pattern**. TÃ¡ch má»—i logic parse ra má»™t class riÃªng (VD: `VnExpressStrategy`, `GenkStrategy`) vÃ  dÃ¹ng `ContentFetcherFactory` Ä‘á»ƒ gá»i.

### 2. Service "Ã´m Ä‘á»“m" - `NewsReaderService.kt`
- **File:** `app/src/main/java/com/skul9x/rssreader/service/NewsReaderService.kt`
- **Váº¥n Ä‘á»:** Service nÃ y Ä‘ang lÃ m quÃ¡ nhiá»u viá»‡c: Quáº£n lÃ½ Service, Ä‘iá»u khiá»ƒn TTS, xá»­ lÃ½ MediaSession, gá»i API Gemini, vÃ  cáº£ quáº£n lÃ½ WakeLock.
- **Táº¡i sao nguy hiá»ƒm:** Class gáº§n 1000 dÃ²ng, khÃ³ debug. Dá»… gÃ¢y memory leak hoáº·c ANR náº¿u khÃ´ng cáº©n tháº­n (dÃ¹ Ä‘Ã£ cÃ³ `releaseWakeLockSafely`).
- **CÃ¡ch sá»­a:** TÃ¡ch logic.
    - `TtsManager`: Chá»‰ lo viá»‡c Ä‘á»c (Ä‘Ã£ cÃ³).
    - `NewsPlayer`: Lo viá»‡c Next/Prev/Play/Pause.
    - `NewsReaderService`: Chá»‰ Ä‘Ã³ng vai trÃ² keo dÃ¡n (Glue) vÃ  cháº¡y Foreground.

### 3. Safety Settings - `GeminiApiClient.kt`
- **File:** `app/src/main/java/com/skul9x/rssreader/data/network/GeminiApiClient.kt`
- **Váº¥n Ä‘á»:** Äang set `BLOCK_NONE` cho táº¥t cáº£ cÃ¡c loáº¡i filter (L747).
- **Táº¡i sao nguy hiá»ƒm:** Google cÃ³ thá»ƒ cháº·n API key náº¿u phÃ¡t hiá»‡n app liÃªn tá»¥c request ná»™i dung "nháº¡y cáº£m", hoáº·c AI cÃ³ thá»ƒ tÃ³m táº¯t ra ná»™i dung khÃ´ng phÃ¹ há»£p.
- **CÃ¡ch sá»­a:** CÃ¢n nháº¯c dÃ¹ng `BLOCK_ONLY_HIGH` hoáº·c `BLOCK_MEDIUM_AND_ABOVE` cho an toÃ n hÆ¡n.

---

## ğŸŸ¢ Suggestions (TÃ¹y chá»n)

1.  **Room Schema Export:**
    - File `AppDatabase.kt` Ä‘ang Ä‘á»ƒ `exportSchema = false`. NÃªn Ä‘á»ƒ `true` vÃ  commit schema json vÃ o git Ä‘á»ƒ theo dÃµi sá»± thay Ä‘á»•i cá»§a DB qua cÃ¡c version.

2.  **Optimize Regex:**
    - `ArticleContentFetcher` dÃ¹ng ráº¥t nhiá»u Regex phá»©c táº¡p. NÃªn cÃ¢n nháº¯c chuyá»ƒn háº³n sang Jsoup (Cleaner) hoáº·c tá»‘i Æ°u Regex Ä‘á»ƒ trÃ¡nh ReDoS (Regex Denial of Service) vá»›i cÃ¡c input Ä‘áº·c biá»‡t.

3.  **Dependency Management:**
    - Dá»± Ã¡n Ä‘ang dÃ¹ng Version Catalog (`libs.*`) nhÆ°ng `build.gradle.kts` váº«n cÃ²n clean. Tiáº¿p tá»¥c phÃ¡t huy!

---

## Next Steps

1.  **Refactor `ArticleContentFetcher`:** ÄÃ¢y lÃ  viá»‡c mang láº¡i giÃ¡ trá»‹ cao nháº¥t, giÃºp code gá»n gÃ ng vÃ  dá»… thÃªm bÃ¡o má»›i.
2.  **TÃ¡ch `NewsReaderService`:** Äá»ƒ code service á»•n Ä‘á»‹nh hÆ¡n.
