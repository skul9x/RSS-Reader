# Audit Report - 2026-01-28

## Summary
- ğŸ”´ **Critical Issues:** 2
- ğŸŸ¡ **Warnings:** 3
- ğŸŸ¢ **Suggestions:** 4

---

## ğŸ”´ Critical Issues (Pháº£i sá»­a ngay)

### 1. Hiá»‡u nÄƒng Database kÃ©m do `ORDER BY RANDOM()`
- **File:** [CachedNewsDao.kt](file:///c:/Users/Admin/Desktop/Test_code/RSS-Reader-main/app/src/main/java/com/skul9x/rssreader/data/local/CachedNewsDao.kt)
- **Váº¥n Ä‘á»:** CÃ¡c hÃ m `getRandomNews` vÃ  `getUnreadRandomNewsFromFeeds` sá»­ dá»¥ng cÃ¢u lá»‡nh SQL `ORDER BY RANDOM()`.
- **Táº¡i sao nguy hiá»ƒm:** Vá»›i SQLite, lá»‡nh nÃ y sáº½ scan **toÃ n bá»™ báº£ng**, gÃ¡n sá»‘ ngáº«u nhiÃªn cho tá»«ng dÃ²ng rá»“i sáº¯p xáº¿p láº¡i. Khi dá»¯ liá»‡u tin tá»©c tÃ­ch tá»¥ lÃªn vÃ i nghÃ¬n bÃ i, thao tÃ¡c nÃ y sáº½ cá»±c cháº­m (O(N log N)), gÃ¢y lag hoáº·c treo UI khi báº¥m "Refresh".
- **CÃ¡ch sá»­a:** DÃ¹ng thuáº­t toÃ¡n tá»‘i Æ°u hÆ¡n. VÃ­ dá»¥: Láº¥y danh sÃ¡ch ID trÆ°á»›c, chá»n ngáº«u nhiÃªn trong code Kotlin, sau Ä‘Ã³ query theo ID. Hoáº·c thÃªm cá»™t random index.

### 2. Nguy cÆ¡ rÃ² rá»‰ dá»¯ liá»‡u qua Backup
- **File:** [AndroidManifest.xml](file:///c:/Users/Admin/Desktop/Test_code/RSS-Reader-main/app/src/main/AndroidManifest.xml)
- **Váº¥n Ä‘á»:** Thiáº¿t láº­p `android:allowBackup="true"`.
- **Táº¡i sao nguy hiá»ƒm:** DÃ¹ báº¡n dÃ¹ng `EncryptedSharedPreferences`, viá»‡c cho phÃ©p backup toÃ n bá»™ app data lÃªn Google Drive cá»§a user cÃ³ thá»ƒ vÃ´ tÃ¬nh backup cáº£ nhá»¯ng file chá»©a key hoáº·c token session náº¿u khÃ´ng config `backup_rules` cá»±c ká»³ cháº·t cháº½. Vá»›i cÃ¡c app báº£o máº­t, nÃªn táº¯t tÃ­nh nÄƒng nÃ y hoáº·c kiá»ƒm tra ká»¹ file `xml/backup_rules`.
- **CÃ¡ch sá»­a:** Set `android:allowBackup="false"` hoáº·c review file `res/xml/backup_rules.xml` Ä‘á»ƒ cháº¯c cháº¯n loáº¡i trá»« file `api_keys_secure.xml`.

---

## ğŸŸ¡ Warnings (NÃªn sá»­a)

### 1. Hardcoded Strings (KhÃ³ báº£o trÃ¬)
- **File:** `NewsReaderService.kt`, `GeminiApiClient.kt`
- **Váº¥n Ä‘á»:** Nhiá»u chuá»—i text hiá»ƒn thá»‹ cho user (vÃ­ dá»¥: "Äang Ä‘á»c...", "Tin thá»©...", "ÄÃ£ Ä‘á»c xong...") Ä‘Æ°á»£c viáº¿t cá»©ng trong code Kotlin thay vÃ¬ dÃ¹ng `res/values/strings.xml`.
- **TÃ¡c Ä‘á»™ng:** KhÃ³ dá»‹ch app sang tiáº¿ng Anh hoáº·c ngÃ´n ngá»¯ khÃ¡c sau nÃ y. KhÃ³ sá»­a ná»™i dung text táº­p trung.

### 2. WakeLock Timeout quÃ¡ dÃ i (30 phÃºt)
- **File:** [NewsReaderService.kt](file:///c:/Users/Admin/Desktop/Test_code/RSS-Reader-main/app/src/main/java/com/skul9x/rssreader/service/NewsReaderService.kt)
- **Váº¥n Ä‘á»:** `wakeLock?.acquire(30 * 60 * 1000L)`.
- **TÃ¡c Ä‘á»™ng:** Náº¿u app bá»‹ crash hoáº·c logic `stopReading` bá»‹ lá»—i khÃ´ng release lock, app sáº½ giá»¯ CPU cháº¡y liÃªn tá»¥c 30 phÃºt, gÃ¢y nÃ³ng mÃ¡y vÃ  tá»¥t pin nghiÃªm trá»ng cho user.
- **CÃ¡ch sá»­a:** Giáº£m timeout xuá»‘ng tháº¥p hÆ¡n (vÃ­ dá»¥ 10 phÃºt) hoáº·c dÃ¹ng cÆ¡ cháº¿ "refresh lock" khi Ä‘ang Ä‘á»c tin.

### 3. Dependency phiÃªn báº£n lá»™n xá»™n
- **File:** `libs.versions.toml`
- **Váº¥n Ä‘á»:** Má»™t sá»‘ thÆ° viá»‡n nhÆ° `androidx.media` (dÃ²ng 85) Ä‘ang hardcode version string `"1.7.0"` thay vÃ¬ Ä‘á»‹nh nghÄ©a variable trong block `[versions]`.
- **TÃ¡c Ä‘á»™ng:** KhÃ³ quáº£n lÃ½ version táº­p trung.

---

## ğŸŸ¢ Suggestions (Tá»‘i Æ°u thÃªm)

1.  **Tá»‘i Æ°u Regex:** `ArticleContentFetcher.kt` Ä‘ang compile regex (`Regex(...)`) trong companion object. ÄÃ¢y lÃ  tá»‘t. Tuy nhiÃªn, danh sÃ¡ch `isRegexPreferred` Ä‘ang hardcode domain. NÃªn chuyá»ƒn danh sÃ¡ch nÃ y vÃ o config (Remote Config hoáº·c Local Config) Ä‘á»ƒ update Ä‘á»™ng mÃ  khÃ´ng cáº§n update app.
2.  **Báº£o máº­t Logs:** `ActivityLogger` vÃ  `DebugLogger` Ä‘ang log khÃ¡ nhiá»u thÃ´ng tin chi tiáº¿t. Cáº§n Ä‘áº£m báº£o cÃ¡c log nÃ y bá»‹ vÃ´ hiá»‡u hÃ³a (strip) á»Ÿ báº£n Build Release (dÃ¹ng ProGuard/R8 rules `assumenosideeffects`).
3.  **Clean Architecture:** Logic "chá»n model Gemini" Ä‘ang náº±m láº«n trong `GeminiApiClient`. NÃªn tÃ¡ch ra thÃ nh má»™t `GeminiModelSelector` riÃªng Ä‘á»ƒ code gá»n hÆ¡n.
4.  **Database Index:** `CachedNewsItem` Ä‘Ã£ cÃ³ index `feedId` vÃ  `titleHash`. Tá»‘t. NÃªn cÃ¢n nháº¯c thÃªm index cho `cachedAt` náº¿u tÃ­nh nÄƒng "XÃ³a tin cÅ©" cháº¡y cháº­m.

---

## Next Steps

Báº¡n muá»‘n mÃ¬nh xá»­ lÃ½ viá»‡c gÃ¬ trÆ°á»›c?

1.  ğŸ›  **FIX CRITICAL:** Sá»­a lá»—i `ORDER BY RANDOM()` vÃ  táº¯t Backup.
2.  ğŸ§¹ **REFACTOR:** Chuyá»ƒn Hardcoded Strings sang `strings.xml`.
3.  ğŸ”‹ **OPTIMIZE:** Tinh chá»‰nh WakeLock vÃ  check Memory Leak.
4.  ğŸ“ **LÆ°u bÃ¡o cÃ¡o:** Káº¿t thÃºc audit táº¡i Ä‘Ã¢y.
